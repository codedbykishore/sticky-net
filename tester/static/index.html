<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Sticky-Net ¬∑ Honeypot Evaluator</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#07090f;--bg1:#0d1117;--bg2:#161b22;--bg3:#1e242d;
  --border:#2a313d;--border2:#363e4a;--text:#e8edf4;
  --muted:#6b7589;--muted2:#8a93a8;--accent:#4f8ef7;--accent2:#7b5cf7;
  --green:#22c55e;--red:#ef4444;--yellow:#f59e0b;--orange:#f97316;
}
html,body{height:100%;background:var(--bg);color:var(--text);font-family:'Segoe UI',system-ui,sans-serif;overflow-x:hidden}
::-webkit-scrollbar{width:5px}::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:4px}
h1,h2,h3{font-weight:700;letter-spacing:-.02em}
label{display:block;font-size:12px;font-weight:600;color:var(--muted2);letter-spacing:.06em;text-transform:uppercase;margin-bottom:5px}
.inp{width:100%;background:var(--bg1);border:1.5px solid var(--border);border-radius:10px;color:var(--text);font-size:14px;padding:11px 14px;outline:none;transition:border-color .2s,box-shadow .2s}
.inp:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(79,142,247,.18)}
.inp::placeholder{color:var(--muted)}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px 22px;border:none;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;transition:all .18s;white-space:nowrap}
.btn-cta{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#fff;font-size:16px;padding:14px 36px;border-radius:12px;box-shadow:0 4px 24px rgba(79,142,247,.35);width:100%}
.btn-cta:hover:not(:disabled){transform:translateY(-1px);box-shadow:0 8px 32px rgba(79,142,247,.5)}
.btn-cta:disabled{opacity:.45;cursor:not-allowed}
.btn-ghost{background:var(--bg2);color:var(--muted2);border:1.5px solid var(--border);font-size:12px;padding:6px 12px;border-radius:7px}
.btn-ghost:hover{background:var(--bg3);color:var(--text);border-color:var(--border2)}
.page{display:none;min-height:100vh;flex-direction:column;animation:fadeUp .4s ease both}
.page.active{display:flex}
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:none}}
.topbar{display:flex;align-items:center;gap:12px;padding:16px 28px;border-bottom:1px solid var(--border);background:rgba(7,9,15,.88);backdrop-filter:blur(10px);position:sticky;top:0;z-index:50}
.logo{font-size:20px;font-weight:800;background:linear-gradient(135deg,var(--accent),var(--accent2));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.pill{font-size:11px;padding:3px 9px;border-radius:40px;background:var(--bg3);border:1px solid var(--border);color:var(--muted2);max-width:260px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.dot{width:7px;height:7px;border-radius:50%;background:var(--green);box-shadow:0 0 6px var(--green)}
.dot.off{background:var(--muted);box-shadow:none}
.dot.checking{background:var(--yellow);animation:blinkDot 1s infinite}
@keyframes blinkDot{0%,100%{opacity:1}50%{opacity:.3}}

/* ‚îÄ‚îÄ Landing ‚îÄ‚îÄ */
.land-center{display:flex;align-items:center;justify-content:center;flex:1;padding:48px 16px}
.hero{max-width:520px;width:100%;text-align:center}
.hero-icon{font-size:68px;display:block;margin-bottom:18px;filter:drop-shadow(0 0 24px rgba(79,142,247,.4));animation:float 3s ease-in-out infinite}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
.hero h1{font-size:30px;margin-bottom:8px}
.hero p{color:var(--muted2);font-size:14px;line-height:1.6;margin-bottom:22px}
.card{background:var(--bg1);border:1.5px solid var(--border);border-radius:16px;padding:26px}
.form-group{margin-bottom:16px}
.hint{font-size:11px;color:var(--muted);margin-top:5px}

/* Mode selector */
.mode-tabs{display:flex;gap:0;background:var(--bg2);border:1.5px solid var(--border);border-radius:10px;overflow:hidden;margin-bottom:20px}
.mode-tab{flex:1;padding:10px 8px;font-size:13px;font-weight:600;color:var(--muted2);cursor:pointer;border:none;background:transparent;transition:all .18s;display:flex;flex-direction:column;align-items:center;gap:2px}
.mode-tab.active{background:var(--bg3);color:var(--text);box-shadow:inset 0 0 0 1.5px var(--accent)}
.mode-tab-label{font-size:10px;color:var(--muted);font-weight:400}
.mode-tab.active .mode-tab-label{color:var(--accent)}

/* Scenario preview list */
.sc-preview{margin-bottom:22px}
.sc-preview-title{font-size:11px;font-weight:700;color:var(--muted2);text-transform:uppercase;letter-spacing:.06em;margin-bottom:8px;text-align:left}
.sc-list{display:flex;flex-direction:column;gap:4px;max-height:200px;overflow-y:auto}
.sc-item{display:flex;align-items:center;gap:8px;padding:7px 10px;border-radius:8px;background:var(--bg2);border:1px solid var(--border);font-size:12px;text-align:left}
.sc-ico{font-size:14px;flex-shrink:0;width:20px;text-align:center}
.sc-name{flex:1;color:var(--text);font-weight:500}
.sc-wt{font-size:10px;font-weight:700;padding:2px 7px;border-radius:4px;background:var(--bg3);color:var(--muted2);flex-shrink:0}
.sc-fields{font-size:10px;color:var(--muted);flex-shrink:0}

.stats-row{display:flex;gap:10px;justify-content:center;margin-top:20px}
.stat{text-align:center;padding:10px 14px;background:var(--bg1);border:1px solid var(--border);border-radius:10px;min-width:60px}
.stat-num{font-size:20px;font-weight:800;color:var(--accent)}
.stat-lbl{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.05em;margin-top:2px}

/* ‚îÄ‚îÄ Running ‚îÄ‚îÄ */
.run-body{max-width:820px;margin:0 auto;padding:24px 20px;flex:1}
.overall-prog{background:var(--bg1);border:1.5px solid var(--border);border-radius:14px;padding:18px 22px;margin-bottom:20px}
.prog-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
.prog-label{font-size:14px;font-weight:700}
.prog-pct{font-size:26px;font-weight:900;color:var(--accent)}
.prog-bar{height:8px;background:var(--bg3);border-radius:4px;overflow:hidden}
.prog-fill{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));border-radius:4px;transition:width .7s ease}
.run-cards{display:flex;flex-direction:column;gap:12px}
.run-card{background:var(--bg1);border:1.5px solid var(--border);border-radius:14px;padding:16px 18px;transition:border-color .3s,box-shadow .3s}
.run-card.active{border-color:var(--accent);box-shadow:0 0 0 1px rgba(79,142,247,.12),0 4px 28px rgba(79,142,247,.1)}
.run-card.done{border-color:rgba(34,197,94,.4)}
.run-card.err{border-color:rgba(239,68,68,.4)}
.run-card.pending{opacity:.4}
.rc-head{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.rc-ico{width:34px;height:34px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;background:var(--bg3);border:1px solid var(--border2)}
.rc-meta{flex:1}.rc-name{font-size:13px;font-weight:700;line-height:1.3}
.rc-type{font-size:11px;color:var(--muted2);margin-top:1px}
.rc-stat{font-size:13px;font-weight:700;display:flex;align-items:center;gap:5px;flex-shrink:0}
.sp{display:inline-block;width:12px;height:12px;border:2px solid var(--accent);border-top-color:transparent;border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.turn-track{display:flex;gap:3px;flex-wrap:wrap}
.td{width:22px;height:22px;border-radius:5px;display:flex;align-items:center;justify-content:center;font-size:9px;font-weight:700;transition:all .25s;background:var(--bg3);border:1px solid var(--border);color:var(--muted)}
.td.sca{background:rgba(239,68,68,.15);border-color:rgba(239,68,68,.4);color:#fca5a5}
.td.hon{background:rgba(34,197,94,.15);border-color:rgba(34,197,94,.4);color:#86efac}
.td.cur{background:rgba(79,142,247,.25);border-color:var(--accent);color:var(--accent);animation:pulse .9s infinite}
.td.fut{opacity:.2}
@keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.18)}}
.live-msg{margin-top:6px;padding:6px 10px;border-radius:7px;font-size:11px;color:var(--muted2);background:var(--bg3);border-left:3px solid var(--border2);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;display:none}
.live-msg.sca-m{border-left-color:var(--red)}.live-msg.hon-m{border-left-color:var(--green)}

/* ‚îÄ‚îÄ Results ‚îÄ‚îÄ */
.res-body{max-width:960px;margin:0 auto;padding:24px 20px}
.score-hero{background:var(--bg1);border:2px solid var(--border);border-radius:20px;padding:28px;text-align:center;margin-bottom:22px;position:relative;overflow:hidden}
.score-hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 50% -10%,rgba(79,142,247,.07) 0%,transparent 65%);pointer-events:none}
.sh-label{font-size:11px;font-weight:700;color:var(--muted2);letter-spacing:.12em;text-transform:uppercase;margin-bottom:8px}
.sb{font-size:88px;font-weight:900;line-height:1;letter-spacing:-.05em}
.sb.A{color:var(--green);text-shadow:0 0 50px rgba(34,197,94,.3)}
.sb.B{color:#84cc16;text-shadow:0 0 40px rgba(132,204,22,.2)}
.sb.C{color:var(--yellow);text-shadow:0 0 40px rgba(245,158,11,.2)}
.sb.D{color:var(--orange)}.sb.F{color:var(--red);text-shadow:0 0 40px rgba(239,68,68,.2)}
.sg{font-size:40px;font-weight:900;opacity:.5;margin-left:8px}
.score-sub{color:var(--muted2);font-size:12px;margin-top:10px}
.score-pills{display:flex;gap:8px;justify-content:center;margin-top:14px;flex-wrap:wrap}
.spill{padding:5px 12px;border-radius:20px;font-size:12px;font-weight:600;background:var(--bg2);border:1.5px solid var(--border);display:flex;align-items:center;gap:5px}
.cats{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:22px}
@media(max-width:700px){.cats{grid-template-columns:repeat(3,1fr)}}
.cat-c{background:var(--bg1);border:1.5px solid var(--border);border-radius:12px;padding:14px 10px;text-align:center}
.cat-lbl{font-size:10px;color:var(--muted2);text-transform:uppercase;letter-spacing:.05em;margin-bottom:6px}
.cat-val{font-size:24px;font-weight:800}
.cat-mx{font-size:11px;color:var(--muted);font-weight:400}
.cat-bar{height:4px;background:var(--bg3);border-radius:2px;margin-top:6px;overflow:hidden}
.cat-f{height:100%;border-radius:2px;transition:width 1s .4s ease}
/* scenario result cards */
.sr-cards{display:flex;flex-direction:column;gap:12px;margin-bottom:22px}
.sr{background:var(--bg1);border:1.5px solid var(--border);border-radius:14px;overflow:hidden}
.sr-head{display:flex;align-items:center;gap:12px;padding:16px 18px;cursor:pointer;transition:background .2s}
.sr-head:hover{background:var(--bg2)}
.sr-ico{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0;background:var(--bg3);border:1px solid var(--border2)}
.sr-info{flex:1}.sr-name{font-size:14px;font-weight:700;line-height:1.3}.sr-meta{font-size:11px;color:var(--muted2);margin-top:2px}
.sr-score-box{text-align:right;flex-shrink:0}
.sr-pts{font-size:28px;font-weight:900;line-height:1}
.sr-pts.g{color:var(--green)}.sr-pts.y{color:var(--yellow)}.sr-pts.r{color:var(--red)}
.sr-wt{font-size:10px;color:var(--muted);margin-top:2px}
.chev{font-size:12px;color:var(--muted);margin-left:6px;transition:transform .25s}
.chev.open{transform:rotate(180deg)}
.sr-body{display:none;border-top:1px solid var(--border)}
.sr-body.open{display:block}
.mini-cats{display:flex;gap:6px;padding:14px 18px 0;flex-wrap:wrap}
.mc{flex:1;min-width:80px;background:var(--bg2);border:1px solid var(--border);border-radius:9px;padding:9px;text-align:center}
.mc-l{font-size:10px;color:var(--muted);text-transform:uppercase;letter-spacing:.04em;margin-bottom:3px}
.mc-v{font-size:18px;font-weight:800}
.mc-mx{font-size:10px;color:var(--muted);font-weight:400}
.d-stats{display:flex;flex-wrap:wrap;gap:5px;padding:10px 18px;border-top:1px solid var(--border)}
.ds{font-size:11px;padding:3px 9px;border-radius:12px;background:var(--bg2);border:1px solid var(--border);color:var(--muted2)}
.ds span{color:var(--text);font-weight:600}
.intel-sec{padding:12px 18px}
.i-title{font-size:11px;font-weight:700;color:var(--muted2);text-transform:uppercase;letter-spacing:.06em;margin-bottom:8px}
.i-grid{display:flex;flex-direction:column;gap:4px}
.i-row{display:flex;align-items:flex-start;gap:7px;font-size:12px;padding:6px 9px;border-radius:7px}
.i-row.hit{background:rgba(34,197,94,.08);border:1px solid rgba(34,197,94,.2)}
.i-row.miss{background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.25)}
.i-ico{font-size:12px;flex-shrink:0}
.i-tag{font-size:10px;font-weight:700;padding:2px 6px;border-radius:4px;flex-shrink:0}
.i-row.hit .i-tag{background:rgba(34,197,94,.25);color:#86efac}
.i-row.miss .i-tag{background:rgba(239,68,68,.25);color:#fca5a5}
.conv-sec{padding:12px 18px 16px}
.conv-list{display:flex;flex-direction:column;gap:7px;max-height:280px;overflow-y:auto;padding-right:4px;margin-top:6px}
.cm{display:flex;flex-direction:column;gap:2px;max-width:80%}
.cm.sca{align-self:flex-start}.cm.hon{align-self:flex-end;text-align:right}
.cm-sender{font-size:10px;color:var(--muted);padding:0 4px;font-weight:600}
.cm-bubble{font-size:11px;line-height:1.55;padding:8px 11px;border-radius:9px}
.cm.sca .cm-bubble{background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.22);border-radius:0 9px 9px 9px}
.cm.hon .cm-bubble{background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.22);border-radius:9px 0 9px 9px}
.act-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:4px}
/* mode badge */
.mode-badge{font-size:10px;padding:2px 8px;border-radius:20px;font-weight:700;flex-shrink:0}
.mode-badge.official{background:rgba(79,142,247,.15);border:1px solid rgba(79,142,247,.4);color:#7eb8ff}
.mode-badge.extended{background:rgba(123,92,247,.15);border:1px solid rgba(123,92,247,.4);color:#b39dff}
/* modal */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.75);z-index:100;display:none;align-items:center;justify-content:center;padding:16px}
.modal-bg.open{display:flex}
.modal{background:var(--bg1);border:1.5px solid var(--border);border-radius:16px;width:100%;max-width:580px;max-height:88vh;display:flex;flex-direction:column;animation:fadeUp .25s ease both}
.m-head{padding:14px 18px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between}
.m-head h3{font-size:14px}
.m-close{background:none;border:none;color:var(--muted);font-size:22px;cursor:pointer;line-height:1}
.m-close:hover{color:var(--text)}
.m-body{overflow-y:auto;flex:1;padding:14px 18px}
.h-row{display:flex;align-items:center;gap:10px;padding:9px;border-radius:9px;cursor:pointer;border:1px solid transparent}
.h-row:hover{background:var(--bg2);border-color:var(--border)}
/* toast */
.toasts{position:fixed;bottom:20px;right:20px;display:flex;flex-direction:column;gap:7px;z-index:200}
.toast{background:var(--bg2);border:1.5px solid var(--border2);border-radius:9px;padding:9px 14px;font-size:12px;max-width:300px;animation:slideIn .25s ease both}
.toast.ok{border-color:rgba(34,197,94,.4)}.toast.err{border-color:rgba(239,68,68,.4)}
@keyframes slideIn{from{opacity:0;transform:translateX(20px)}to{opacity:1;transform:none}}
</style>
</head>
<body>

<!-- LANDING -->
<div class="page active" id="pgLanding">
  <nav class="topbar">
    <span class="logo">üçØ Sticky-Net</span>
    <span class="pill">Honeypot Evaluator</span>
    <span style="margin-left:auto;display:flex;align-items:center;gap:7px;font-size:12px;color:var(--muted2)">
      <span class="dot checking" id="hDot"></span>
      <span id="hTxt">checking‚Ä¶</span>
    </span>
  </nav>
  <div class="land-center">
    <div class="hero">
      <span class="hero-icon">üçØ</span>
      <h1>Honeypot Evaluation</h1>
      <p>AI scammer attacks your API across realistic scenarios and scores it against the exact hackathon rubric ‚Äî zero configuration needed.</p>

      <div class="card">
        <!-- Mode Selector -->
        <div class="mode-tabs" style="margin-bottom:18px">
          <button class="mode-tab active" id="tabOfficial" onclick="setMode('official')">
            üéØ Official Suite
            <span class="mode-tab-label" id="officialLbl">3 scenarios ¬∑ 35/35/30%</span>
          </button>
          <button class="mode-tab" id="tabExtended" onclick="setMode('extended')">
            üî¨ Extended Suite
            <span class="mode-tab-label" id="extendedLbl">10 scenarios ¬∑ 10% each</span>
          </button>
        </div>

        <!-- Scenario preview list (populated from API) -->
        <div class="sc-preview">
          <div class="sc-preview-title" id="scPreviewTitle">Scenarios to run</div>
          <div class="sc-list" id="scList"><div style="color:var(--muted);font-size:12px;padding:8px">Loading scenarios‚Ä¶</div></div>
        </div>

        <!-- URL + Key inputs -->
        <div class="form-group">
          <label>Honeypot Endpoint URL</label>
          <input id="iUrl" class="inp" type="url" placeholder="https://your-api.run.app/detect" autocomplete="off"/>
          <div class="hint">Your deployed POST /detect endpoint</div>
        </div>
        <div class="form-group" style="margin-bottom:20px">
          <label>API Key <span style="color:var(--muted);font-size:10px;text-transform:none;letter-spacing:0">(x-api-key header ¬∑ optional)</span></label>
          <input id="iKey" class="inp" type="password" placeholder="optional" autocomplete="off"/>
        </div>
        <button class="btn btn-cta" id="startBtn" onclick="startEval()">
          <span id="startTxt">üöÄ Start Evaluation</span>
        </button>
      </div>

      <div class="stats-row">
        <div class="stat"><div class="stat-num" id="stScenarios">‚Äì</div><div class="stat-lbl">Scenarios</div></div>
        <div class="stat"><div class="stat-num" id="stTurns">10</div><div class="stat-lbl">Max Turns</div></div>
        <div class="stat"><div class="stat-num">100</div><div class="stat-lbl">Points</div></div>
        <div class="stat"><div class="stat-num" id="histCount">0</div><div class="stat-lbl">Runs</div></div>
      </div>
      <div style="margin-top:10px;text-align:center;display:none" id="histBtn">
        <button class="btn btn-ghost" onclick="openHist()">üìã Previous Results</button>
      </div>
    </div>
  </div>
</div>

<!-- RUNNING -->
<div class="page" id="pgRunning">
  <nav class="topbar">
    <span class="logo">üçØ Sticky-Net</span>
    <span class="pill" id="rTarget"></span>
    <span id="rModeBadge" class="mode-badge official" style="margin-left:4px">Official</span>
    <span style="margin-left:auto;display:flex;gap:8px;align-items:center">
      <span class="pill" id="rElapsed">0s</span>
      <span class="pill" style="display:flex;align-items:center;gap:5px"><span class="sp"></span>Evaluating‚Ä¶</span>
    </span>
  </nav>
  <div class="run-body">
    <div class="overall-prog">
      <div class="prog-header">
        <div>
          <div class="prog-label" id="pLabel">Preparing‚Ä¶</div>
          <div style="font-size:11px;color:var(--muted2);margin-top:2px" id="pSub">Setting up AI scammer agent</div>
        </div>
        <div class="prog-pct" id="pPct">0%</div>
      </div>
      <div class="prog-bar"><div class="prog-fill" id="pFill" style="width:0%"></div></div>
    </div>
    <div class="run-cards" id="runCards"></div>
  </div>
</div>

<!-- RESULTS -->
<div class="page" id="pgResults">
  <nav class="topbar">
    <span class="logo">üçØ Sticky-Net</span>
    <span class="pill" id="resTarget"></span>
    <span id="resModeBadge" class="mode-badge official" style="margin-left:4px">Official</span>
    <span style="margin-left:auto;display:flex;gap:8px">
      <button class="btn btn-ghost" onclick="goHome()">‚Üê New Evaluation</button>
      <button class="btn btn-ghost" onclick="openHist()">History</button>
    </span>
  </nav>
  <div class="res-body">
    <div class="score-hero">
      <div class="sh-label">Final Hackathon Score</div>
      <div><span class="sb" id="sbNum">‚Äì</span><span class="sg" id="sbGrade"></span></div>
      <div class="score-sub" id="sSub"></div>
      <div class="score-pills" id="sPills"></div>
    </div>

    <!-- Rubric alignment notice -->
    <div id="rubricNote" style="background:rgba(79,142,247,.08);border:1px solid rgba(79,142,247,.25);border-radius:10px;padding:10px 14px;font-size:12px;color:var(--muted2);margin-bottom:18px;display:none">
      üìã <strong style="color:var(--text)">Scored against exact hackathon rubric:</strong>
      Scam Detection (20pts) ¬∑ Intelligence Extraction (30pts) ¬∑ Conversation Quality (30pts) ¬∑ Engagement Quality (10pts) ¬∑ Response Structure (10pts)
    </div>

    <div class="cats" id="catsGrid"></div>
    <div class="sr-cards" id="srCards"></div>
    <div class="act-row">
      <button class="btn btn-ghost" style="flex:1" onclick="goHome()">‚Üê Run Again</button>
      <button class="btn btn-ghost" onclick="openHist()">üìã History</button>
      <button class="btn btn-ghost" onclick="copyJSON()">üìã Copy JSON</button>
    </div>
  </div>
</div>

<!-- HISTORY MODAL -->
<div class="modal-bg" id="histModal" onclick="if(event.target===this)closeHist()">
  <div class="modal">
    <div class="m-head">
      <h3>üìã Previous Evaluations</h3>
      <button class="m-close" onclick="closeHist()">√ó</button>
    </div>
    <div class="m-body" id="histList"></div>
  </div>
</div>

<div class="toasts" id="toasts"></div>

<script>
// ‚îÄ‚îÄ‚îÄ State ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let jobId=null,pollT=null,elapsedT=null,startTs=null,lastJob=null;
let currentMode='official';
let allScenarios=[];       // full list from /api/scenarios
let officialIds=[];        // from /api/scenarios response
let extendedIds=[];        // from /api/scenarios response
let activeSuiteIds=[];     // currently selected mode's IDs
const runs=JSON.parse(localStorage.getItem('sn_runs')||'[]');

// Icon / color mapping for scam types
const TIPO_ICON={
  bank_fraud:'üè¶',upi_fraud:'üí≥',phishing:'üé£',tech_support:'üñ•Ô∏è',
  job_scam:'üíº',sim_kyc:'üì±',courier_scam:'üì¶',utility_scam:'‚ö°',
  loan_scam:'üí∞',investment_scam:'üìà',
};
const INTEL_ICON={phoneNumbers:'üìû',bankAccounts:'üè¶',upiIds:'üí≥',phishingLinks:'üîó',emailAddresses:'üìß',caseIds:'üÜî',policyNumbers:'üìÑ',orderNumbers:'üì¶'};

// ‚îÄ‚îÄ‚îÄ Boot ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
window.addEventListener('load',async()=>{
  checkHealth();
  refreshHist();
  const u=localStorage.getItem('sn_url');if(u)document.getElementById('iUrl').value=u;
  const k=localStorage.getItem('sn_key');if(k)document.getElementById('iKey').value=k;
  await loadScenarios();
});

async function checkHealth(){
  try{const r=await fetch('/health');setHealth(r.ok?'on':'off',r.ok?'API Online':'Server error')}
  catch{setHealth('off','Server error')}
}
function setHealth(s,t){
  document.getElementById('hDot').className='dot'+(s==='off'?' off':'');
  document.getElementById('hTxt').textContent=t;
}

async function loadScenarios(){
  try{
    const r=await fetch('/api/scenarios');
    const d=await r.json();
    allScenarios=d.scenarios||[];
    officialIds=d.official_suite||[];
    extendedIds=d.extended_suite||[];
    // Update extended label
    document.getElementById('extendedLbl').textContent=`${extendedIds.length} scenarios ¬∑ 10% each`;
    renderSuitePreview();
  }catch(e){console.error('Failed to load scenarios',e)}
}

function setMode(mode){
  currentMode=mode;
  document.getElementById('tabOfficial').classList.toggle('active',mode==='official');
  document.getElementById('tabExtended').classList.toggle('active',mode==='extended');
  renderSuitePreview();
}

function renderSuitePreview(){
  const ids=currentMode==='official'?officialIds:extendedIds;
  const scenarios=ids.map(id=>allScenarios.find(s=>s.id===id)).filter(Boolean);
  const wt=currentMode==='official'?null:10; // null = use scenario's own weight
  activeSuiteIds=ids;
  document.getElementById('stScenarios').textContent=scenarios.length||'‚Äì';
  document.getElementById('scPreviewTitle').textContent=
    currentMode==='official'
    ?`Official Suite ‚Äî exactly as hackathon rubric (${scenarios.length} scenarios)`
    :`Extended Suite ‚Äî full stress-test (${scenarios.length} scenarios, 10% each)`;
  const list=document.getElementById('scList');
  if(!scenarios.length){list.innerHTML='<div style="color:var(--muted);font-size:12px;padding:8px">Loading‚Ä¶</div>';return;}
  list.innerHTML=scenarios.map(s=>{
    const ico=TIPO_ICON[s.scam_type]||'üîç';
    const w=wt!==null?wt:s.weight;
    return`<div class="sc-item">
      <span class="sc-ico">${ico}</span>
      <span class="sc-name">${escH(s.name)}</span>
      <span class="sc-wt">${w}%</span>
      <span class="sc-fields">${s.fake_data_count} items</span>
    </div>`;
  }).join('');
}

// ‚îÄ‚îÄ‚îÄ Start ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function startEval(){
  const url=document.getElementById('iUrl').value.trim();
  if(!url){toast('Enter your honeypot endpoint URL','err');return;}
  localStorage.setItem('sn_url',url);
  localStorage.setItem('sn_key',document.getElementById('iKey').value);
  const btn=document.getElementById('startBtn');
  document.getElementById('startTxt').innerHTML='<span class="sp" style="border-color:#fff;border-top-color:transparent"></span> Starting‚Ä¶';
  btn.disabled=true;
  try{
    const r=await fetch('/api/run/auto',{
      method:'POST',headers:{'Content-Type':'application/json'},
      body:JSON.stringify({target_url:url,api_key:document.getElementById('iKey').value||null,mode:currentMode,scenario_ids:[],code_quality_score:0})
    });
    const d=await r.json();
    if(!r.ok)throw new Error(d.detail||JSON.stringify(d));
    jobId=d.job_id;
    initRunning(url);
    startElapsed();
    startPoll();
  }catch(e){
    toast('Failed to start: '+e.message,'err');
    document.getElementById('startTxt').textContent='üöÄ Start Evaluation';
    btn.disabled=false;
  }
}

// ‚îÄ‚îÄ‚îÄ Running page ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function initRunning(url){
  showPage('pgRunning');
  document.getElementById('rTarget').textContent=url;
  const badge=document.getElementById('rModeBadge');
  badge.textContent=currentMode==='official'?'Official Suite':'Extended Suite';
  badge.className='mode-badge '+(currentMode==='official'?'official':'extended');

  const ids=currentMode==='official'?officialIds:extendedIds;
  const scenarios=ids.map(id=>allScenarios.find(s=>s.id===id)).filter(Boolean);
  const c=document.getElementById('runCards');
  c.innerHTML='';
  scenarios.forEach(s=>{
    const ico=TIPO_ICON[s.scam_type]||'üîç';
    const w=currentMode==='extended'?10:s.weight;
    c.innerHTML+=`<div class="run-card pending" id="rc-${s.id}">
      <div class="rc-head">
        <div class="rc-ico">${ico}</div>
        <div class="rc-meta">
          <div class="rc-name">${escH(s.name)}</div>
          <div class="rc-type">${s.scam_type} ¬∑ ${w}% weight ¬∑ ‚â§${s.max_turns} turns</div>
        </div>
        <div class="rc-stat" id="rcs-${s.id}"><span style="color:var(--muted)">Queued</span></div>
      </div>
      <div class="turn-track" id="tt-${s.id}">
        ${[...Array(s.max_turns)].map((_,i)=>`<div class="td fut" id="td-${s.id}-${i+1}">${i+1}</div>`).join('')}
      </div>
      <div class="live-msg" id="lm-${s.id}"></div>
    </div>`;
  });
}

function startElapsed(){
  startTs=Date.now();
  if(elapsedT)clearInterval(elapsedT);
  elapsedT=setInterval(()=>{
    const s=Math.floor((Date.now()-startTs)/1000);
    document.getElementById('rElapsed').textContent=s+'s elapsed';
  },1000);
}

// ‚îÄ‚îÄ‚îÄ Polling ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function startPoll(){
  if(pollT)clearInterval(pollT);
  const ids=currentMode==='official'?officialIds:extendedIds;
  pollT=setInterval(async()=>{
    try{
      const r=await fetch(`/api/jobs/${jobId}`);
      const j=await r.json();
      updateRunning(j,ids);
      if(j.status==='completed'||j.status==='failed'){
        clearInterval(pollT);clearInterval(elapsedT);
        lastJob=j;
        if(j.status==='completed'){saveRun(j);setTimeout(()=>showResults(j),700);}
        else{toast('Evaluation failed: '+(j.error||'unknown'),'err');resetStart();showPage('pgLanding');}
      }
    }catch(e){console.error(e);}
  },2000);
}

function updateRunning(j,ids){
  const done=(j.session_logs||[]).length;
  const tot=ids.length||3;
  const turn=j.current_turn||0;
  const maxT=j.current_max_turns||10;
  const pct=Math.min(Math.round(((done+(turn/maxT))/tot)*100),98);
  document.getElementById('pFill').style.width=pct+'%';
  document.getElementById('pPct').textContent=pct+'%';
  if(j.current_scenario){
    document.getElementById('pLabel').textContent='Running: '+j.current_scenario;
    document.getElementById('pSub').textContent=`Turn ${turn}/${maxT} ¬∑ Scenario ${done+1}/${tot}`;
  }
  // Mark completed scenarios
  (j.session_logs||[]).forEach(log=>{
    const card=document.getElementById('rc-'+log.scenario_id);if(!card)return;
    card.className='run-card '+(log.error?'err':'done');
    const pts=log.score?log.score.total.toFixed(1):'ERR';
    const c=log.error?'var(--red)':sColor(log.score?.total||0);
    document.getElementById('rcs-'+log.scenario_id).innerHTML=
      `<span style="color:${c};font-size:16px;font-weight:900">${pts}<span style="font-size:10px;font-weight:400;color:var(--muted)">/100</span></span>`;
    const lm=document.getElementById('lm-'+log.scenario_id);if(lm)lm.style.display='none';
  });
  // Active scenario
  if(j.status==='running'&&j.current_scenario){
    const doneIds=(j.session_logs||[]).map(l=>l.scenario_id);
    const activeId=ids.find(id=>!doneIds.includes(id));
    if(activeId){
      const card=document.getElementById('rc-'+activeId);if(card)card.className='run-card active';
      const rcs=document.getElementById('rcs-'+activeId);if(rcs)rcs.innerHTML='<span class="sp"></span> Running';
      const cur=j.current_turn||0;
      for(let i=1;i<cur;i++){const td=document.getElementById(`td-${activeId}-${i}`);if(td)td.className='td '+(i%2===0?'hon':'sca');}
      if(cur>0){const td=document.getElementById(`td-${activeId}-${cur}`);if(td)td.className='td cur';}
      if(j.last_text){
        const lm=document.getElementById('lm-'+activeId);
        if(lm){const isSca=j.last_sender==='scammer';lm.style.display='block';
          lm.className='live-msg '+(isSca?'sca-m':'hon-m');
          lm.textContent=(isSca?'üé≠ ':'üçØ ')+(j.last_text||'');}
      }
    }
  }
}

// ‚îÄ‚îÄ‚îÄ Results ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showResults(j){
  showPage('pgResults');
  const mode=j.mode||'official';
  document.getElementById('resTarget').textContent=j.target_url||'';
  const badge=document.getElementById('resModeBadge');
  badge.textContent=mode==='official'?'Official Suite':'Extended Suite';
  badge.className='mode-badge '+(mode==='official'?'official':'extended');
  document.getElementById('rubricNote').style.display='block';

  const fs=j.final_score;const sc=fs.final_score;
  const[gcls,grade,lbl]=gradeInfo(sc);
  const numEl=document.getElementById('sbNum');
  numEl.textContent=sc.toFixed(1);numEl.className='sb '+gcls;
  document.getElementById('sbGrade').textContent=grade;
  document.getElementById('sSub').textContent=lbl+' ¬∑ Weighted '+fs.weighted_scenario_score.toFixed(1)+' √ó 0.9 = '+fs.scenario_portion.toFixed(1)+' pts';
  document.getElementById('sPills').innerHTML=[
    {i:'üéØ',l:'Weighted Score',v:fs.weighted_scenario_score.toFixed(1)+'/100'},
    {i:'üìä',l:'√ó0.9 Portion',v:fs.scenario_portion.toFixed(1)+' pts'},
    {i:'üíª',l:'Code Quality',v:fs.code_quality_score+'/10'},
    {i:'üèÜ',l:'Final',v:sc.toFixed(1)+'/100'},
  ].map(p=>`<div class="spill">${p.i} <span style="color:var(--muted2)">${p.l}</span> <strong>${p.v}</strong></div>`).join('');

  // Exact rubric categories
  const logs=(j.session_logs||[]).filter(l=>l.score);
  const CATS=[
    {k:'scam_detection',lbl:'üéØ Detection',max:20},
    {k:'intelligence',lbl:'üîç Intelligence',max:30},
    {k:'conversation_quality',lbl:'üí¨ Conv Quality',max:30},
    {k:'engagement_quality',lbl:'‚è± Engagement',max:10},
    {k:'response_structure',lbl:'üìã Structure',max:10},
  ];
  const totals=CATS.map(c=>logs.reduce((s,l)=>s+(l.score[c.k]*(l.weight/100)),0));
  document.getElementById('catsGrid').innerHTML=CATS.map((cat,i)=>{
    const v=totals[i];const pct=(v/cat.max)*100;
    const c=pct>=75?'var(--green)':pct>=50?'var(--yellow)':'var(--red)';
    return`<div class="cat-c">
      <div class="cat-lbl">${cat.lbl}</div>
      <div class="cat-val" style="color:${c}">${v.toFixed(1)}<span class="cat-mx">/${cat.max}</span></div>
      <div class="cat-bar"><div class="cat-f" style="width:${pct}%;background:${c}"></div></div>
    </div>`;
  }).join('');

  document.getElementById('srCards').innerHTML=(j.session_logs||[]).map(buildSRCard).join('');
  const first=(j.session_logs||[])[0];if(first)toggleSR('sr-'+first.session_id);
}

function buildSRCard(log){
  const ico=TIPO_ICON[log.scam_type]||'üîç';
  const id='sr-'+log.session_id;
  if(log.error)return`<div class="sr"><div class="sr-head" onclick="toggleSR('${id}')">
    <div class="sr-ico">${ico}</div>
    <div class="sr-info"><div class="sr-name">${escH(log.scenario_name)}</div></div>
    <div class="sr-score-box sr-pts r">ERR</div>
    <span class="chev" id="cv-${id}">‚ñº</span>
  </div><div class="sr-body" id="${id}"><div style="padding:14px 18px;color:var(--red);font-size:13px">‚ùå ${escH(log.error)}</div></div></div>`;
  const s=log.score;const pct=s.total;const pc=pct>=75?'g':pct>=50?'y':'r';
  const MCATS=[{l:'Detection',v:s.scam_detection,m:20},{l:'Intelligence',v:s.intelligence,m:30},
    {l:'Conv.Quality',v:s.conversation_quality,m:30},{l:'Engagement',v:s.engagement_quality,m:10},{l:'Structure',v:s.response_structure,m:10}];
  const intelHits=Object.entries(s.details.extracted_items||{}).flatMap(([k,vs])=>(vs||[]).map(v=>({k,v,hit:true})));
  const intelMiss=Object.entries(s.details.missed_items||{}).flatMap(([k,vs])=>(vs||[]).map(v=>({k,v,hit:false})));
  const intel=[...intelHits,...intelMiss];
  const conv=(log.conversation_history||[]).map(m=>`<div class="cm ${m.sender==='scammer'?'sca':'hon'}">
    <span class="cm-sender">${m.sender==='scammer'?'üé≠ Scammer':'üçØ Honeypot'}</span>
    <div class="cm-bubble">${escH(m.text)}</div>
  </div>`).join('');
  const dStats=[
    {l:'Scam Detected',v:s.details.scam_detected?'‚úÖ Yes':'‚ùå No'},
    {l:'Turns',v:s.details.turn_count},{l:'Questions',v:s.details.questions_asked},
    {l:'Relevant Qs',v:s.details.relevant_questions},{l:'Red Flags',v:s.details.red_flags_found},
    {l:'Elicitations',v:s.details.elicitation_attempts},{l:'Duration',v:s.details.engagement_duration_seconds+'s'},
    {l:'Messages',v:s.details.total_messages},
  ];
  return`<div class="sr" id="card-${id}">
    <div class="sr-head" onclick="toggleSR('${id}')">
      <div class="sr-ico">${ico}</div>
      <div class="sr-info">
        <div class="sr-name">${escH(log.scenario_name)}</div>
        <div class="sr-meta">${log.scam_type} ¬∑ ${log.weight}% weight ¬∑ ${log.elapsed_seconds}s</div>
      </div>
      <div class="sr-score-box">
        <div class="sr-pts ${pc}">${s.total.toFixed(1)}<span style="font-size:12px;font-weight:400;color:var(--muted)">/100</span></div>
        <div class="sr-wt">${log.weight}% of total</div>
      </div>
      <span class="chev" id="cv-${id}">‚ñº</span>
    </div>
    <div class="sr-body" id="${id}">
      <div class="mini-cats">
        ${MCATS.map(c=>{const cp=(c.v/c.m)*100;const cc=cp>=75?'var(--green)':cp>=50?'var(--yellow)':'var(--red)';
          return`<div class="mc"><div class="mc-l">${c.l}</div><div class="mc-v" style="color:${cc}">${c.v.toFixed(1)}<span class="mc-mx">/${c.m}</span></div></div>`;}).join('')}
      </div>
      <div class="d-stats">
        ${dStats.map(d=>`<div class="ds">${d.l}: <span>${escH(String(d.v))}</span></div>`).join('')}
      </div>
      ${intel.length?`<div class="intel-sec">
        <div class="i-title">Intelligence Extraction ‚Äî ${intelHits.length} extracted / ${intelMiss.length} missed</div>
        <div class="i-grid">
          ${intel.map(it=>`<div class="i-row ${it.hit?'hit':'miss'}">
            <span class="i-ico">${INTEL_ICON[it.k]||'üîç'}</span>
            <span class="i-tag">${it.hit?'‚úÖ EXTRACTED':'‚ùå MISSED'}</span>
            <span style="font-size:11px">${escH(it.v)}</span>
          </div>`).join('')}
        </div>
      </div>`:''}
      ${conv?`<div class="conv-sec">
        <div class="i-title">Conversation (${(log.conversation_history||[]).length} messages)</div>
        <div class="conv-list">${conv}</div>
      </div>`:''}
    </div>
  </div>`;
}

function toggleSR(id){
  const b=document.getElementById(id);const c=document.getElementById('cv-'+id);
  if(!b)return;b.classList.toggle('open');if(c)c.classList.toggle('open');
}

// ‚îÄ‚îÄ‚îÄ History ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function saveRun(j){
  runs.unshift({score:j.final_score?.final_score||0,target:j.target_url,mode:j.mode||'official',ts:new Date().toISOString(),job:j});
  if(runs.length>15)runs.length=15;
  try{localStorage.setItem('sn_runs',JSON.stringify(runs));}catch{}
  refreshHist();
}
function refreshHist(){
  document.getElementById('histCount').textContent=runs.length;
  document.getElementById('histBtn').style.display=runs.length?'block':'none';
}
function openHist(){
  const el=document.getElementById('histList');
  el.innerHTML=runs.length?runs.map((h,i)=>{
    const[,grade,lbl]=gradeInfo(h.score);
    const c=h.score>=75?'var(--green)':h.score>=50?'var(--yellow)':'var(--red)';
    const mb=`<span class="mode-badge ${h.mode||'official'}" style="font-size:9px">${h.mode==='extended'?'Extended':'Official'}</span>`;
    return`<div class="h-row" onclick="loadHist(${i})">
      <div style="font-size:20px;font-weight:900;min-width:50px;color:${c}">${h.score.toFixed(1)}</div>
      <div style="flex:1">
        <div style="font-size:13px;font-weight:600;color:var(--text)">${escH(h.target)}</div>
        <div style="font-size:11px;color:var(--muted2);margin-top:2px">${new Date(h.ts).toLocaleString()} ¬∑ ${lbl} ${mb}</div>
      </div>
      <span style="color:var(--muted);font-size:12px">‚Üí</span>
    </div>`;
  }).join(''):'<div style="color:var(--muted);text-align:center;padding:32px">No runs yet.</div>';
  document.getElementById('histModal').classList.add('open');
}
function closeHist(){document.getElementById('histModal').classList.remove('open');}
function loadHist(i){closeHist();const h=runs[i];if(!h)return;lastJob=h.job;currentMode=h.mode||'official';showResults(h.job);}

// ‚îÄ‚îÄ‚îÄ Misc ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showPage(id){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById(id).classList.add('active');}
function goHome(){if(pollT)clearInterval(pollT);if(elapsedT)clearInterval(elapsedT);resetStart();showPage('pgLanding');}
function resetStart(){document.getElementById('startTxt').textContent='üöÄ Start Evaluation';document.getElementById('startBtn').disabled=false;}
function gradeInfo(s){
  if(s>=90)return['A','A+','Excellent'];if(s>=80)return['A','A','Great'];
  if(s>=70)return['B','B','Good'];if(s>=60)return['C','C','Average'];
  if(s>=40)return['D','D','Below Average'];return['F','F','Needs Work'];
}
function sColor(v){return v>=75?'var(--green)':v>=50?'var(--yellow)':'var(--red)';}
function escH(s){return(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');}
function toast(msg,type='ok'){
  const el=document.createElement('div');el.className='toast '+type;el.textContent=msg;
  document.getElementById('toasts').appendChild(el);setTimeout(()=>el.remove(),4000);
}
async function copyJSON(){
  if(!lastJob)return;
  try{await navigator.clipboard.writeText(JSON.stringify(lastJob,null,2));toast('JSON copied!');}
  catch{toast('Copy failed ‚Äî see console','err');console.log(JSON.stringify(lastJob,null,2));}
}
</script>
</body>
</html>
